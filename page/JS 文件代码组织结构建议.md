# JS 文件代码组织结构建议
<p align="center" style="color:red">（郑勇 20171113）</p>

### Ext.js 使用体验
在刚接触 PSI 时,感觉看着最费劲的就是 JS 文件了，在我看来主要有两个方面。

> * 对 ExtJS 框架不太熟悉，第一次接触这个框架很多东西都需要学习。
* PSI 中的 JS 文件中代码量很大，动辄上千行的代码看着确实很头大，有时看一个功能点需要在一个 JS 文件中翻来覆去看很多遍才能理顺逻辑。

对于第一个问题，可以通过阅读学习代码，动手实践就可以慢慢理解。对于第二个问题，可以做的就是控制代码质量来提高代码的可读性与可维护性，代码质量需要靠代码规范来约束。

### JS 文件方法结构分类

一般情况下在 JS 文件中我们写的方法大概分为

* Ext 组件生命周期方法
* Ajax 网络请求方法
* 操作事件方法
* 监听方法
* 私有方法
* 创建组件方法

目前我自己在写 JS 文件时代码组织大概是按照以下模块和顺序，整个 JS 文件看着就如下：

-------
    ## 配置项
    config: {}
-------
    ## Ext 组件的生命周期
    initComponent: function (){}
    onWndShow: function () {}
    onWndClose: function () {}
    ...
-------
    ## Ajax 请求方法
    onQuery: function () {}//查询数据请求
    onOK: function () {}//保存数据请求
    ...
-------
    ## 操作事件方法 一般为按钮点击事件方法
    onAddBusiness: function () {}
    onEditBusiness: function () {}
    ...
-------
    ## 监听方法
    onLastQueryEditSpecialKey: function (field, e) {}
    onEditSpecialKey : function(field, e) {}
    ...
-------
    ## 私有方法 一般为处理数据的方法
    getSaveData : function() {}
    getQueryParam : function() {}
    ...
-------
    ## 创建组件方法 一般为各个组件的初始化方法
    getQueryCmp: function () {}
    getMainGrid: function () {}
    getDetailGrid: function () {}
    ...
    
### 每个模块的具体内容
* Ext 组件的生命周期方法

>  这类方法是 Ext 组件从创建到展示出来再到界面关闭最后到销毁的整个过程中所必须经过的方法。我们常用的如：**initComponent**，**onWndShow**，**onWndClose** 等方法是属于这类方法。一般这类方法都是排在 JS 文件的最前面。

* Ajax 网络请求方法

>  这类方法一般都是和后台逻辑有很强的关联的，换句话说就是和业务逻辑是密不可分的。那么这类方法的重要性就不言而喻了，我们在调试 Bug 的时候打交道最多的也是这类方法了。把它们排在前面也很方便我们修改代码逻辑，调试代码。

* 操作事件方法

> 这类方法一般都是按钮的点击事件会触发的方法，和前端的交互是有最直接的联系。它们对于前端的交互逻辑是很重要的。各种前端的操作事件会触发的方法应该单独拿出来放到这个区域。

* 监听方法

> 这类方法目前为止我见到最多的就是查询组件中的输入框会触发的方法。一个 JS 文件一般只有 **onEditSpecialKey**， **onLastQueryEditSpecialKey** 这两个方法。

* 私有方法

> 私有方法很少会出现，这类方法我目前主要是用来加工数据使用，比如说比较复杂的查询条件参数的组装，需要保存的大量数据的拼接。

* 创建组件方法

> 这类方法每个界面都会存在，就是创建组件的时候需要调用的方法。这类方法是 Ext 代码冗余的根本所在，也是我把这类方法放在 JS 文件最后面的原因。生成某些比较复杂的组件，一个方法就能占几百行（Goods/MainForm.js 文件中的 getMainGrid 方法足足占了 300 行还要多），如果把这类方法放在最前面，将是很可怕的存在，它将会严重影响我们阅读理解代码的效率。一般这类方法写完基本上也不会出现什么问题，除非界面改动，要不然是很少会来修改这些方法的。所以我建议把这类方法放到 JS 文件末尾。

### 总结

PSI JS 层是我们系统前端的整个核心，以上也是我接触 Ext 这一段时间对 JS 层文件代码结构的一些总结，统一代码结构规范可以尽可能给业务人员在写业务代码时减负，提高业务代码的可维护性。当然，如果有哪些观点会给开发带来不便，大家可以一起探讨出一份更适合业务的规范。

我看过的一些比较好的关于代码质量的文章（欢迎补充）：

[关于烂代码的那些事系列](http://blog.2baxb.me/archives/1343)
[编程的智慧](http://www.yinwang.org/blog-cn/2015/11/21/programming-philosophy)
[如何写出无法维护的代码](https://coolshell.cn/articles/4758.html)


